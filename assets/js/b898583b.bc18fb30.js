"use strict";(globalThis.webpackChunkvbrowser_documentation=globalThis.webpackChunkvbrowser_documentation||[]).push([[738],{1780(e,r,n){n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"installation/terraform","title":"Terraform","description":"Open vBrowser (OvB) uses Terraform as the sole mechanism for provisioning and destroying cloud infrastructure. This ensures deployments are reproducible, auditable, and fully reversible.","source":"@site/docs/installation/terraform.md","sourceDirName":"installation","slug":"/installation/terraform","permalink":"/docs/installation/terraform","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Installation","permalink":"/docs/category/installation"},"next":{"title":"AWS Configuration","permalink":"/docs/installation/aws"}}');var s=n(4848),o=n(8453);const l={sidebar_position:1},t="Terraform",a={},d=[{value:"Install Terraform",id:"install-terraform",level:2},{value:"Why Terraform Is Required",id:"why-terraform-is-required",level:2},{value:"What Terraform Provisions",id:"what-terraform-provisions",level:2},{value:"Compute",id:"compute",level:3},{value:"Container Registry",id:"container-registry",level:3},{value:"Identity &amp; Access Management",id:"identity--access-management",level:3},{value:"Networking",id:"networking",level:3},{value:"Logging",id:"logging",level:3},{value:"Terraform State",id:"terraform-state",level:2},{value:"Browser Image Integration",id:"browser-image-integration",level:2},{value:"Region Configuration",id:"region-configuration",level:2},{value:"Running Terraform",id:"running-terraform",level:2},{value:"Destroying Infrastructure",id:"destroying-infrastructure",level:2},{value:"Safe Modification Guidelines",id:"safe-modification-guidelines",level:2},{value:"Common Failure Scenarios",id:"common-failure-scenarios",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"terraform",children:"Terraform"})}),"\n",(0,s.jsxs)(r.p,{children:["Open vBrowser (OvB) uses ",(0,s.jsx)(r.strong,{children:"Terraform as the sole mechanism"})," for provisioning and destroying cloud infrastructure. This ensures deployments are reproducible, auditable, and fully reversible."]}),"\n",(0,s.jsxs)(r.p,{children:["This page explains ",(0,s.jsx)(r.strong,{children:"what Terraform provisions"}),", ",(0,s.jsx)(r.strong,{children:"how OvB uses it"}),", and ",(0,s.jsx)(r.strong,{children:"what operators should understand before applying changes"}),"."]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"install-terraform",children:"Install Terraform"}),"\n",(0,s.jsxs)(r.p,{children:["To run OvB's infrastructure components, you\u2019ll need ",(0,s.jsx)(r.a,{href:"https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli",children:"Terraform"}),". Here's how to install it on a Debian-based Linux system (e.g. Ubuntu):"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"1. Update and install prerequisites"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"sudo apt-get update -y && sudo apt-get install -y gnupg software-properties-common\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"2. Install the HashiCorp GPG Key"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"wget -O- https://apt.releases.hashicorp.com/gpg | \\\ngpg --dearmor | \\\nsudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg > /dev/null\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"3. Add the official HashiCorp repository to your linux system."})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] \\\nhttps://apt.releases.hashicorp.com $(grep -oP '(?<=UBUNTU_CODENAME=).*' /etc/os-release || lsb_release -cs) main\" | \\\nsudo tee /etc/apt/sources.list.d/hashicorp.list\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"4. Download the package information"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"sudo apt update -y\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"5. Install Terraform"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"sudo apt-get install -y terraform\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"why-terraform-is-required",children:"Why Terraform Is Required"}),"\n",(0,s.jsx)(r.p,{children:"OvB is not a single-container application. It requires coordinated creation of multiple cloud resources that must be:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Created in a specific order"}),"\n",(0,s.jsx)(r.li,{children:"Properly permissioned"}),"\n",(0,s.jsx)(r.li,{children:"Consistently tagged and referenced"}),"\n",(0,s.jsx)(r.li,{children:"Easily destroyed when no longer needed"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Terraform provides:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Infrastructure as Code (IaC)"}),"\n",(0,s.jsx)(r.li,{children:"Predictable state management"}),"\n",(0,s.jsx)(r.li,{children:"One-command teardown"}),"\n",(0,s.jsx)(r.li,{children:"Reduced configuration drift"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Manual provisioning is ",(0,s.jsx)(r.strong,{children:"not supported"}),"."]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"what-terraform-provisions",children:"What Terraform Provisions"}),"\n",(0,s.jsx)(r.p,{children:"Running Terraform for OvB creates the following categories of resources:"}),"\n",(0,s.jsx)(r.h3,{id:"compute",children:"Compute"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"ECS Cluster"}),"\n",(0,s.jsx)(r.li,{children:"ECS Task Definitions"}),"\n",(0,s.jsx)(r.li,{children:"ECS Services"}),"\n",(0,s.jsx)(r.li,{children:"ECS Task Execution Roles"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"container-registry",children:"Container Registry"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"ECR repositories for browser images"}),"\n",(0,s.jsx)(r.li,{children:"ECR repository for backend images"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"identity--access-management",children:"Identity & Access Management"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"IAM roles for ECS tasks"}),"\n",(0,s.jsx)(r.li,{children:"IAM policies with least-privilege permissions"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"networking",children:"Networking"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Subnet selection"}),"\n",(0,s.jsx)(r.li,{children:"Security group associations"}),"\n",(0,s.jsx)(r.li,{children:"Internal service connectivity"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"logging",children:"Logging"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"CloudWatch log groups"}),"\n",(0,s.jsx)(r.li,{children:"ECS task logging configuration"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"All resources are scoped to the AWS region you select."}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"terraform-state",children:"Terraform State"}),"\n",(0,s.jsx)(r.p,{children:"Terraform state tracks:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Created resources"}),"\n",(0,s.jsx)(r.li,{children:"Resource dependencies"}),"\n",(0,s.jsx)(r.li,{children:"Outputs required by runtime services"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["State is stored ",(0,s.jsx)(r.strong,{children:"locally by default"}),"."]}),"\n",(0,s.jsx)(r.admonition,{type:"caution",children:(0,s.jsx)(r.p,{children:"Do not delete or manually edit Terraform state files.\nLoss of state may require manual cleanup of AWS resources."})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"browser-image-integration",children:"Browser Image Integration"}),"\n",(0,s.jsx)(r.p,{children:"Terraform dynamically configures ECS task definitions based on selected browser images."}),"\n",(0,s.jsx)(r.p,{children:"During setup:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Selected browsers are written to ",(0,s.jsx)(r.code,{children:"terraform.tfvars"})]}),"\n",(0,s.jsx)(r.li,{children:"Terraform generates task definitions for each browser"}),"\n",(0,s.jsx)(r.li,{children:"Only approved images are deployable"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"This prevents accidental execution of unapproved browser containers."}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"region-configuration",children:"Region Configuration"}),"\n",(0,s.jsx)(r.p,{children:"The AWS region is defined by:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"AWS_DEFAULT_REGION"})," (environment variable)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"aws_region"})," in ",(0,s.jsx)(r.code,{children:"terraform.tfvars"})]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"The setup script ensures both values remain synchronized."}),"\n",(0,s.jsx)(r.admonition,{type:"important",children:(0,s.jsx)(r.p,{children:"Changing regions requires a full destroy and redeploy.\nTerraform does not migrate resources between regions."})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"running-terraform",children:"Running Terraform"}),"\n",(0,s.jsx)(r.p,{children:"Terraform is executed automatically by the setup script:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"terraform init\nterraform apply -auto-approve\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Manual execution is supported for advanced operators, but ",(0,s.jsx)(r.strong,{children:"not required"}),"."]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"destroying-infrastructure",children:"Destroying Infrastructure"}),"\n",(0,s.jsx)(r.p,{children:"Terraform is also responsible for clean teardown."}),"\n",(0,s.jsx)(r.p,{children:"The destroy process:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Stops ECS services"}),"\n",(0,s.jsx)(r.li,{children:"Deregisters task definitions"}),"\n",(0,s.jsx)(r.li,{children:"Deletes ECR repositories"}),"\n",(0,s.jsx)(r.li,{children:"Removes IAM roles and policies"}),"\n",(0,s.jsx)(r.li,{children:"Cleans up logging resources"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Destruction is handled via:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"terraform destroy -auto-approve\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Or by running the provided ",(0,s.jsx)(r.code,{children:"destroy.sh"})," script."]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"safe-modification-guidelines",children:"Safe Modification Guidelines"}),"\n",(0,s.jsx)(r.p,{children:"Operators should:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Avoid editing Terraform files unless necessary"}),"\n",(0,s.jsx)(r.li,{children:"Never modify generated task definitions manually"}),"\n",(0,s.jsx)(r.li,{children:"Re-run setup after configuration changes"}),"\n",(0,s.jsx)(r.li,{children:"Always destroy before major changes"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Terraform files are tightly coupled to OvB runtime behavior."}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"common-failure-scenarios",children:"Common Failure Scenarios"}),"\n",(0,s.jsx)(r.p,{children:"Common Terraform-related issues include:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Insufficient IAM permissions"}),"\n",(0,s.jsx)(r.li,{children:"Region mismatch"}),"\n",(0,s.jsx)(r.li,{children:"Stale state files"}),"\n",(0,s.jsx)(r.li,{children:"Interrupted applies"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"These issues are typically resolved by:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Fixing permissions"}),"\n",(0,s.jsxs)(r.li,{children:["Running ",(0,s.jsx)(r.code,{children:"terraform init -reconfigure"})]}),"\n",(0,s.jsx)(r.li,{children:"Performing a clean destroy and redeploy"}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsx)(r.p,{children:"After understanding Terraform\u2019s role, configure your AWS account:"}),"\n",(0,s.jsxs)(r.p,{children:["Continue to ",(0,s.jsx)(r.strong,{children:"AWS Configuration"})]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,r,n){n.d(r,{R:()=>l,x:()=>t});var i=n(6540);const s={},o=i.createContext(s);function l(e){const r=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(o.Provider,{value:r},e.children)}}}]);