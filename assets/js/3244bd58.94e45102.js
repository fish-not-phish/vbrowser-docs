"use strict";(globalThis.webpackChunkvbrowser_documentation=globalThis.webpackChunkvbrowser_documentation||[]).push([[785],{3235(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"installation/script-setup","title":"Setup Script","description":"The setup.sh script is the primary orchestration entry point for deploying Open vBrowser (OvB). It automates environment preparation, infrastructure provisioning, image management, and service startup.","source":"@site/docs/installation/script-setup.md","sourceDirName":"installation","slug":"/installation/script-setup","permalink":"/docs/installation/script-setup","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Cloudflare Configuration","permalink":"/docs/installation/cloudflare"},"next":{"title":"Environment Variables","permalink":"/docs/installation/environment-variables"}}');var i=r(4848),t=r(8453);const d={sidebar_position:4},l="Setup Script",c={},o=[{value:"Purpose of the Setup Script",id:"purpose-of-the-setup-script",level:2},{value:"Download Git Repo",id:"download-git-repo",level:2},{value:"Execution Context",id:"execution-context",level:2},{value:"Default Browser Images",id:"default-browser-images",level:2},{value:"Interactive Prompt Behavior",id:"interactive-prompt-behavior",level:2},{value:"Custom Image Input Format",id:"custom-image-input-format",level:2},{value:"Core Application Settings",id:"core-application-settings",level:2},{value:"Database Configuration",id:"database-configuration",level:2},{value:"Redis Configuration",id:"redis-configuration",level:2},{value:"Django Superuser (Initial Admin Account)",id:"django-superuser-initial-admin-account",level:2},{value:"Cloudflare Integration",id:"cloudflare-integration",level:2},{value:"AWS Configuration",id:"aws-configuration",level:2},{value:"Setup Notes",id:"setup-notes",level:2},{value:"Step 1: Browser Image Selection",id:"step-1-browser-image-selection",level:2},{value:"Step 2: Secret Generation",id:"step-2-secret-generation",level:2},{value:"Step 3: Environment Variable Collection",id:"step-3-environment-variable-collection",level:2},{value:"Step 4: Environment Augmentation",id:"step-4-environment-augmentation",level:2},{value:"Step 5: Terraform Configuration Patching",id:"step-5-terraform-configuration-patching",level:2},{value:"Step 6: Infrastructure Provisioning",id:"step-6-infrastructure-provisioning",level:2},{value:"Step 7: Environment Propagation",id:"step-7-environment-propagation",level:2},{value:"Step 8: Docker Image Builds",id:"step-8-docker-image-builds",level:2},{value:"Step 9: Service Startup",id:"step-9-service-startup",level:2},{value:"containers-updater Execution",id:"containers-updater-execution",level:2},{value:"Completion Criteria",id:"completion-criteria",level:2},{value:"Common Failure Scenarios",id:"common-failure-scenarios",level:2},{value:"Idempotency and Re-Runs",id:"idempotency-and-re-runs",level:2},{value:"Next Steps",id:"next-steps",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"setup-script",children:"Setup Script"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"setup.sh"})," script is the ",(0,i.jsx)(n.strong,{children:"primary orchestration entry point"})," for deploying Open vBrowser (OvB). It automates environment preparation, infrastructure provisioning, image management, and service startup."]}),"\n",(0,i.jsxs)(n.p,{children:["This document explains ",(0,i.jsx)(n.strong,{children:"what the script does"}),", ",(0,i.jsx)(n.strong,{children:"why each step exists"}),", and ",(0,i.jsx)(n.strong,{children:"what operators should expect during execution"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"purpose-of-the-setup-script",children:"Purpose of the Setup Script"}),"\n",(0,i.jsx)(n.p,{children:"The setup script exists to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Eliminate manual deployment steps"}),"\n",(0,i.jsx)(n.li,{children:"Enforce a consistent deployment process"}),"\n",(0,i.jsx)(n.li,{children:"Reduce configuration drift"}),"\n",(0,i.jsx)(n.li,{children:"Prevent partial or insecure setups"}),"\n",(0,i.jsx)(n.li,{children:"Provide a single, auditable entry point"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Running ",(0,i.jsx)(n.code,{children:"setup.sh"})," is the ",(0,i.jsx)(n.strong,{children:"only supported deployment method"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"download-git-repo",children:"Download Git Repo"}),"\n",(0,i.jsx)(n.p,{children:"Download the content from the GitHub repository:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/fish-not-phish/open-vbrowser.git\ncd open-vbrowser/terraform\n"})}),"\n",(0,i.jsx)(n.h2,{id:"execution-context",children:"Execution Context"}),"\n",(0,i.jsxs)(n.p,{children:["The script is executed from the ",(0,i.jsx)(n.code,{children:"terraform/"})," directory. Run the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./setup.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"It assumes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A Linux shell environment"}),"\n",(0,i.jsx)(n.li,{children:"Docker and Terraform are installed"}),"\n",(0,i.jsx)(n.li,{children:"AWS and Cloudflare credentials are available"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"default-browser-images",children:"Default Browser Images"}),"\n",(0,i.jsx)(n.p,{children:"By default, the following browser images are used:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"chrome"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"mullvad"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"tor"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"interactive-prompt-behavior",children:"Interactive Prompt Behavior"}),"\n",(0,i.jsx)(n.p,{children:"During setup, you will see the following prompt:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Default images: chrome, mullvad, tor\nUse default images? [Y/n]: \n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Press ",(0,i.jsx)(n.strong,{children:"Enter"})," or type ",(0,i.jsx)(n.strong,{children:"Y"})," to accept the default images."]}),"\n",(0,i.jsxs)(n.li,{children:["Type ",(0,i.jsx)(n.strong,{children:"n"})," to provide a custom list of images."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If you choose ",(0,i.jsx)(n.strong,{children:"n"}),", you will be prompted to enter your desired images."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"custom-image-input-format",children:"Custom Image Input Format"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Images must be separated by a ",(0,i.jsx)(n.strong,{children:"comma and a space"})]}),"\n",(0,i.jsx)(n.li,{children:"Example:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"chrome, firefox, brave\n"})}),"\n",(0,i.jsx)(n.p,{children:"This input will replace the default image list."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h1,{id:"environment-variable-reference",children:"Environment Variable Reference"}),"\n",(0,i.jsxs)(n.p,{children:["When prompted for a value during setup, you may ",(0,i.jsx)(n.strong,{children:"press Enter to accept the default value"})," (if one exists)."]}),"\n",(0,i.jsxs)(n.p,{children:["Variables marked ",(0,i.jsx)(n.strong,{children:"Recommend to Change: Yes"})," should be reviewed and customized for your environment."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"core-application-settings",children:"Core Application Settings"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Recommend to Change"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DEBUG"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"False"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsxs)(n.td,{children:["Should remain ",(0,i.jsx)(n.code,{children:"False"})," in production."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CUSTOM_DOMAIN"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"domain.tld"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsxs)(n.td,{children:["Set to your public domain (e.g. ",(0,i.jsx)(n.code,{children:"example.com"}),")."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LOGGER_ENABLED"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"False"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Enable only if additional logging is required."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DEFAULT_IDLE_THRESHOLD"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"10"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Idle timeout in minutes."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"database-configuration",children:"Database Configuration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Recommend to Change"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DB_NAME"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"vbrowserdb"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Database name for the application."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DB_USER"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"admin"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{children:"Database username."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DB_PASSWORD"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"adminpass"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{children:"Database password."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DB_HOST"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"postgres"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Works by default with Docker Compose."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DB_PORT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5432"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Standard PostgreSQL port."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"redis-configuration",children:"Redis Configuration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Recommend to Change"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_URL"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"redis://redis:6379/0"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Default works with bundled Redis container."})]})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["You may need to change the ",(0,i.jsx)(n.code,{children:"DB_HOST"})," or ",(0,i.jsx)(n.code,{children:"REDIS_URL"})," if you have existing PostgreSQL or Redis containers alive."]}),(0,i.jsxs)(n.p,{children:["If this is the case, change the ",(0,i.jsx)(n.code,{children:"container_name"})," inside the ",(0,i.jsx)(n.code,{children:"open-vbrowser/docker/vbrowser-stack/docker-compose.yml"})," for one or both the postgres and redis service(s)."]}),(0,i.jsx)(n.p,{children:"Example:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",children:'services:\n  postgres:\n    image: postgres:16-alpine\n    container_name: custom-postgres    # new custom PostgreSQL name\n    restart: unless-stopped\n    environment:\n      POSTGRES_DB: "${DB_NAME:-}"\n      POSTGRES_USER: "${DB_USER:-}"\n      POSTGRES_PASSWORD: "${DB_PASSWORD:-}"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\n  redis:\n    image: redis:7-alpine\n    container_name: custom-redis    # new custom redis name\n    restart: unless-stopped\n'})}),(0,i.jsx)(n.p,{children:"Your new values would be:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"DB_HOST=custom-postgres\nREDIS_URL=redis://custom-redis:6379/0\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"django-superuser-initial-admin-account",children:"Django Superuser (Initial Admin Account)"}),"\n",(0,i.jsxs)(n.p,{children:["These values are used ",(0,i.jsx)(n.strong,{children:"once on first startup"})," to create the initial admin user."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Recommend to Change"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DJANGO_SUPERUSER_USERNAME"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"admin"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{children:"Admin username."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DJANGO_SUPERUSER_EMAIL"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"admin@domain.tld"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{children:"Admin email address."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DJANGO_SUPERUSER_PASSWORD"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SuperSecretPassword123!"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{children:"Strong password recommended."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"cloudflare-integration",children:"Cloudflare Integration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Recommend to Change"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CF_Zone_ID"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"xxxx"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{children:"Required for Cloudflare integration."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CF_Token"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"xxxx"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{children:"API token with DNS permissions."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"aws-configuration",children:"AWS Configuration"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Recommend to Change"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AWS_DEFAULT_REGION"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"us-east-1"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Change only if using a different AWS region."})]})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"setup-notes",children:"Setup Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["You may ",(0,i.jsx)(n.strong,{children:"press Enter to accept the default value"})," when one is provided."]}),"\n",(0,i.jsxs)(n.li,{children:["Review and update all variables marked ",(0,i.jsx)(n.strong,{children:"Recommend to Change: Yes"})," before deployment."]}),"\n",(0,i.jsx)(n.li,{children:"Secrets (passwords, tokens, API keys) should never be committed to version control."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["The below steps are built into the ",(0,i.jsx)(n.code,{children:"./setup.sh"})," script. For the purposes of this guide, we are detailing what the script is doing under the hood. You are not expected to execute any additional commands other than running the setup script."]}),(0,i.jsx)(n.p,{children:"Please enter the correct values for each variable the script prompts you for."})]}),"\n",(0,i.jsx)(n.h2,{id:"step-1-browser-image-selection",children:"Step 1: Browser Image Selection"}),"\n",(0,i.jsxs)(n.p,{children:["OvB treats browser containers as ",(0,i.jsx)(n.strong,{children:"explicitly approved execution environments"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"During this step:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A default browser set is offered:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"chrome"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"mullvad"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"tor"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Operators may choose a custom subset"}),"\n",(0,i.jsxs)(n.li,{children:["Unselected browser directories are moved to ",(0,i.jsx)(n.code,{children:"unused/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Selected browser directories remain in ",(0,i.jsx)(n.code,{children:"vbrowsers/"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This ensures:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Only approved browsers are built"}),"\n",(0,i.jsx)(n.li,{children:"Reduced build time"}),"\n",(0,i.jsx)(n.li,{children:"Smaller ECR footprint"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The selected images are written into ",(0,i.jsx)(n.code,{children:"terraform.tfvars"})," as ",(0,i.jsx)(n.code,{children:"docker_images"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-2-secret-generation",children:"Step 2: Secret Generation"}),"\n",(0,i.jsx)(n.p,{children:"The script generates a secure Django secret key:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cryptographically random"}),"\n",(0,i.jsx)(n.li,{children:"Base64-derived"}),"\n",(0,i.jsx)(n.li,{children:"Trimmed to a safe length"}),"\n",(0,i.jsxs)(n.li,{children:["Written only to ",(0,i.jsx)(n.code,{children:".env"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Secrets are ",(0,i.jsx)(n.strong,{children:"never hardcoded"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-3-environment-variable-collection",children:"Step 3: Environment Variable Collection"}),"\n",(0,i.jsx)(n.p,{children:"The script interactively prompts for required configuration values, including:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Application settings"}),"\n",(0,i.jsx)(n.li,{children:"Database configuration"}),"\n",(0,i.jsx)(n.li,{children:"Redis configuration"}),"\n",(0,i.jsx)(n.li,{children:"AWS region"}),"\n",(0,i.jsx)(n.li,{children:"Cloudflare credentials"}),"\n",(0,i.jsx)(n.li,{children:"Admin user credentials"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Defaults are provided for most values."}),"\n",(0,i.jsxs)(n.p,{children:["At completion, all values are written to a single ",(0,i.jsx)(n.code,{children:".env"})," file."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-4-environment-augmentation",children:"Step 4: Environment Augmentation"}),"\n",(0,i.jsx)(n.p,{children:"Additional values are derived automatically:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"ALLOWED_HOSTS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"USER_EMAIL"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"AWS_DEFAULT_REGION"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This ensures internal consistency across services."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-5-terraform-configuration-patching",children:"Step 5: Terraform Configuration Patching"}),"\n",(0,i.jsx)(n.p,{children:"The script updates Terraform inputs to match selected configuration:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Browser image list"}),"\n",(0,i.jsx)(n.li,{children:"AWS region"}),"\n",(0,i.jsx)(n.li,{children:"Logging region settings"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This guarantees Terraform and runtime services remain synchronized."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-6-infrastructure-provisioning",children:"Step 6: Infrastructure Provisioning"}),"\n",(0,i.jsx)(n.p,{children:"Terraform is executed automatically:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"terraform init\nterraform apply -auto-approve\n"})}),"\n",(0,i.jsx)(n.p,{children:"This provisions:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ECS cluster and services"}),"\n",(0,i.jsx)(n.li,{children:"ECR repositories"}),"\n",(0,i.jsx)(n.li,{children:"IAM roles and policies"}),"\n",(0,i.jsx)(n.li,{children:"Networking resources"}),"\n",(0,i.jsx)(n.li,{children:"Logging infrastructure"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-7-environment-propagation",children:"Step 7: Environment Propagation"}),"\n",(0,i.jsxs)(n.p,{children:["The generated ",(0,i.jsx)(n.code,{children:".env"})," file is copied into:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"django/.env"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker/containers-update/.env"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker/vbrowser-stack/.env"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This creates a ",(0,i.jsx)(n.strong,{children:"single source of truth"})," for configuration."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-8-docker-image-builds",children:"Step 8: Docker Image Builds"}),"\n",(0,i.jsx)(n.p,{children:"The script builds required images locally:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"vbrowser"})," (Django backend)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"containers-updater"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Images are tagged locally and prepared for ECR push."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-9-service-startup",children:"Step 9: Service Startup"}),"\n",(0,i.jsx)(n.p,{children:"Docker Compose is used to start services:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"containers-update"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"vbrowser-stack"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,i.jsx)(n.p,{children:"The order ensures images are built before services attempt to use them."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"containers-updater-execution",children:"containers-updater Execution"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"containers-updater"})," service:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Builds selected browser images"}),"\n",(0,i.jsx)(n.li,{children:"Pushes images to AWS ECR"}),"\n",(0,i.jsx)(n.li,{children:"Prepares images for ECS tasks"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Operators ",(0,i.jsx)(n.strong,{children:"must wait"})," for this process to complete before launching sessions."]}),"\n",(0,i.jsx)(n.p,{children:"Monitor progress with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker logs containers-updater -f\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"completion-criteria",children:"Completion Criteria"}),"\n",(0,i.jsx)(n.p,{children:"The setup process is complete when:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Terraform apply succeeds"}),"\n",(0,i.jsx)(n.li,{children:"All Docker services are running"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"containers-updater"})," logs indicate completion"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"At this point, OvB is ready to accept sessions."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-failure-scenarios",children:"Common Failure Scenarios"}),"\n",(0,i.jsx)(n.p,{children:"Common issues include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cloudflare DNS propagation delays"}),"\n",(0,i.jsx)(n.li,{children:"Invalid API token permissions"}),"\n",(0,i.jsx)(n.li,{children:"Insufficient AWS IAM permissions"}),"\n",(0,i.jsx)(n.li,{children:"Interrupted Terraform runs"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Most issues are resolved by:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fixing credentials"}),"\n",(0,i.jsx)(n.li,{children:"Waiting for DNS propagation"}),"\n",(0,i.jsxs)(n.li,{children:["Running ",(0,i.jsx)(n.code,{children:"destroy.sh"})," and re-running setup"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"idempotency-and-re-runs",children:"Idempotency and Re-Runs"}),"\n",(0,i.jsxs)(n.p,{children:["The setup script is designed to be re-run safely ",(0,i.jsx)(n.strong,{children:"after teardown"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Partial re-runs without destroy are ",(0,i.jsx)(n.strong,{children:"not recommended"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsx)(n.p,{children:"After setup completes successfully:"}),"\n",(0,i.jsxs)(n.p,{children:["Continue to ",(0,i.jsx)(n.strong,{children:"Environment Variables"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,r){r.d(n,{R:()=>d,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function d(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);